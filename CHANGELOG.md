# 变更日志

本文档记录了 NodePass WebUI 的所有重要更改。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，项目遵循 [语义化版本控制](https://semver.org/lang/zh-CN/)。

## [1.1.0] - 2025-06-05

### 🚀 重大改进

#### SSE服务架构整合
- **整合SSE服务到Next.js应用**: 将原本独立运行的SSE服务完全整合到Next.js应用内，实现单端口运行
- **全局SSE管理器**: 实现了跨上下文的SSE管理器单例模式，解决了服务间通信问题
- **智能模式检测**: 自动检测运行模式（整合/分离），无需手动配置切换
- **性能优化**: 消除了网络延迟，提高了实时事件传输效率

#### Docker部署简化
- **单一容器架构**: 从双容器（前端+后端）简化为单容器部署
- **端口统一**: 只需要暴露3000端口，简化了网络配置
- **镜像优化**: 重新设计Dockerfile，减少镜像体积和构建时间
- **环境变量简化**: 精简环境变量配置，降低部署复杂度

### ✨ 新增功能

#### 实时监控增强
- **隧道实例管理**: 完善的隧道生命周期管理（创建、更新、删除）
- **流量统计实时更新**: 实时显示TCP/UDP流量数据
- **事件转发机制**: 智能的事件转发和订阅系统
- **实例唯一性保证**: 防止重复隧道实例创建

#### SSL自签名证书支持
- **HTTPS兼容性**: 内置对自签名SSL证书的支持
- **自动检测**: 自动识别HTTPS端点并适配SSL配置
- **安全优化**: 仅在服务器端调用中跳过证书验证，保持客户端安全

### 🔧 技术改进

#### 代码质量优化
- **TypeScript错误修复**: 修复了多个TypeScript类型错误
- **构建流程优化**: 改进了Next.js构建配置和流程
- **日志系统完善**: 增强了调试和监控日志输出
- **错误处理增强**: 改进了异常处理和错误恢复机制

#### 数据库优化
- **隧道实例追踪**: 改进了隧道实例的数据库存储和查询
- **流量数据处理**: 优化了BigInt类型的流量数据转换
- **事件存储**: 完善了SSE事件的持久化存储

### 🐛 问题修复

#### SSE连接稳定性
- **连接管理**: 修复了SSE连接的生命周期管理问题
- **重连机制**: 改进了自动重连逻辑和错误恢复
- **内存泄漏**: 解决了事件监听器的内存泄漏问题
- **并发处理**: 修复了高并发场景下的竞态条件

#### UI/UX改进
- **响应式布局**: 修复了移动端显示问题
- **主题切换**: 改进了深色/浅色主题的一致性
- **加载状态**: 优化了各种加载和错误状态的显示
- **表单验证**: 增强了表单输入验证和错误提示

### 📦 依赖更新
- **Next.js**: 确保与Next.js 15.3.1的完全兼容
- **HeroUI**: 更新到最新版本，改进组件稳定性
- **Prisma**: 升级数据库ORM，提高查询性能
- **Node.js**: 兼容Node.js 18+版本

### 🗑️ 移除内容
- **分离模式文件**: 移除了不再需要的分离模式配置文件
- **冗余脚本**: 清理了package.json中的过时脚本
- **废弃API**: 移除了不再使用的API端点

### 📚 文档更新
- **Docker部署指南**: 完全重写了Docker部署文档
- **API文档**: 更新了API接口文档和示例
- **配置说明**: 简化了环境变量和配置说明
- **故障排除**: 新增了常见问题解决方案

### 🔄 迁移指南

#### 从v1.0.x升级到v1.1.0

**Docker用户**:
```bash
# 停止旧版本
docker-compose down

# 拉取新版本
docker pull ghcr.io/NodePassProject/NodePassDash:latest

# 使用新的配置启动
docker-compose -f docker-compose.release.yml up -d
```

**本地开发**:
```bash
# 更新依赖
pnpm install

# 重新构建
pnpm build

# 使用新的整合模式启动
pnpm dev:integrated
```

**环境变量更新**:
- 添加: `NEXT_PUBLIC_SSE_MODE=integrated`
- 移除: `NEXT_PUBLIC_SSE_API_URL` (整合模式下不再需要)

---

## [1.0.0] - 2025-06-03

### 🎉 首次发布
- 基础的NodePass管理界面
- 端点和隧道管理功能
- 实时监控和日志查看
- Docker化部署支持 